; sdcard functions

; send cmd and return R1 in a
cmd_r1: ; hl: cmd data
    push bc
    ld b, 6
    call spi_cs_assert
.cmd_r1_loop:
    ld a, (hl)
    inc hl
    call spi_wait
    call spi_transmit
    djnz .cmd_r1_loop
    call spi_cs_deassert
    pop bc
    ret



sdcard_init:
    ld hl, .cmd0_data
    call cmd_r1
    ret


.cmd0_data:  db 0x40, 0x00, 0x00, 0x00, 0x00, 0x95
.cmd8_data:  db 0x48, 0x00, 0x00, 0x01, 0x00, 0xd5
.cmd17_data: db 0x51, 0x00, 0x01, 0x00, 0x00, 0x0b
.cmd24_data: db 0x58, 0x00, 0x01, 0x00, 0x00, 0x31
.cmd41_data: db 0x69, 0x40, 0x00, 0x00, 0x00, 0x77
.cmd55_data: db 0x77, 0x00, 0x00, 0x00, 0x00, 0x65
.cmd58_data: db 0x7a, 0x00, 0x00, 0x00, 0x00, 0xfd
